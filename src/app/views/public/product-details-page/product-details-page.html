<!-- product-detail.component.html -->
<section class="product-detail-page">
    <div class="detail-container">

        <!-- LEFT: Product Details -->
        <div class="product-main">

            <!-- Image Gallery -->
            <div class="image-gallery">
                <div class="main-image">
                    <img [src]="product.image" [alt]="product.name">
                </div>
                <div class="thumbnail-list">
                    <img src="/assets/images/images__1_-removebg-preview.png" class="thumb active">
                    <img src="/assets/images/images-removebg-preview.png" class="thumb">
                    <img src="/assets/images/download-removebg-preview.png" class="thumb">
                </div>
            </div>

            <!-- Product Info -->
            <div class="product-info">
                <h1 class="product-title">{{ product.name }}</h1>

                <div class="rating">
                    <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                        class="fa-solid fa-star"></i><i class="fa-solid fa-star-half-stroke"></i>
                    <span>{{ product.rating }} ({{ product.reviews }} reviews)</span>
                </div>

                <div class="price-section">
                    <span class="current-price">${{ product.price }}</span>
                    <span class="old-price">${{ product.oldPrice }}</span>
                    <span class="discount-badge">{{ product.discount }} OFF</span>
                </div>

                <p class="description">
                    {{ product.description }}
                </p>

                <div class="actions">
                    <div class="quantity-selector">
                        <button (click)="decrement()">âˆ’</button>
                        <input type="number" [(ngModel)]="quantity" min="1">
                        <button (click)="increment()">+</button>
                    </div>

                    <button class="btn-add-to-cart" (click)="addToCart()">
                        <i class="fa-solid fa-cart-plus"></i>
                        Add to Cart
                    </button>

                    <button class="btn-wishlist">
                        <i class="fa-regular fa-heart"></i>
                    </button>
                </div>

                <div class="meta-info">
                    <p><strong>Category:</strong> {{ product.type }}</p>
                    <p><strong>SKU:</strong> {{ product.sku }}</p>
                    <p><strong>Availability:</strong> <span class="in-stock">In Stock</span></p>
                </div>
            </div>
        </div>

        <!-- RIGHT: Sticky Checkout Sidebar -->
        <aside class="checkout-sidebar">
            <div class="sidebar-card">
                <h3>Order Summary</h3>

                <div class="summary-line">
                    <span>Subtotal ({{ quantity }} item{{ quantity > 1 ? 's' : '' }})</span>
                    <span class="price">${{ (product.price * quantity).toFixed(2) }}</span>
                </div>

                <div class="summary-line">
                    <span>Shipping</span>
                    <span class="free">Free</span>
                </div>

                <div class="summary-line promo">
                    <input type="text" placeholder="Promo code" class="promo-input">
                    <button class="apply-btn">Apply</button>
                </div>

                <div class="summary-total">
                    <strong>Total</strong>
                    <strong class="total-price">${{ (product.price * quantity).toFixed(2) }}</strong>
                </div>

                <button class="btn-checkout">
                    Proceed to Checkout
                </button>

                <div class="secure-badges">
                    <i class="fa-solid fa-shield-halved" style="font-size: 45px;"></i>
                    <i class="fa-brands fa-cc-visa" style="font-size: 45px;"></i>
                    <i class="fa-brands fa-cc-mastercard" style="font-size: 45px;"></i>
                </div>
            </div>
        </aside>
    </div>
</section>

<div class="reviews-section">
    <h2 class="section-title">Customer Reviews</h2>

    <!-- Overall Rating Summary -->
    <div class="rating-summary">
        <div class="overall-rating">
            <span class="big-rating">{{ product.rating }}</span>
            <div class="stars">
                <i class="fa-solid fa-star" *ngFor="let star of [1,2,3,4,5]"
                    [ngClass]="{'filled': star <= product.rating, 'half': star - 0.5 === product.rating}"></i>
            </div>
            <p class="review-count">Based on {{ product.reviews }} reviews</p>
        </div>

        <!-- Rating Distribution Bars -->
        <div class="rating-bars">
            <div class="bar-line" *ngFor="let level of [5,4,3,2,1]">
                <span class="star-label">{{level}} <i class="fa-solid fa-star"></i></span>
                <div class="progress-bg">
                    <div class="progress-fill" [style.width.%]="getRatingPercentage(level)"></div>
                </div>
                <span class="count">{{ getReviewCount(level) }}</span>
            </div>
        </div>
    </div>

    <!-- Individual Reviews -->
    <div class="customer-reviews">
        <div class="review-card" *ngFor="let review of reviews">
            <div class="review-header">
                <div class="reviewer-info">
                    <div class="avatar" [style.background-image]="'url(' + review.avatar + ')'"></div>
                    <div>
                        <h4 class="reviewer-name">{{ review.name }}</h4>
                        <span class="verified">Verified Purchase <i class="fa-solid fa-check-circle"></i></span>
                    </div>
                </div>
                <div class="review-rating">
                    <i class="fa-solid fa-star filled" *ngFor="let s of [].constructor(review.rating)"></i>
                    <i class="fa-regular fa-star" *ngFor="let s of [].constructor(5 - review.rating)"></i>
                </div>
            </div>

            <p class="review-date">{{ review.date }}</p>
            <h5 class="review-title">{{ review.title }}</h5>
            <p class="review-text">{{ review.comment }}</p>

            <div class="review-images" *ngIf="review.images?.length">
                <img [src]="img" *ngFor="let img of review.images" class="review-img">
            </div>

            <div class="review-actions">
                <button class="helpful-btn">
                    <i class="fa-regular fa-thumbs-up"></i> Helpful ({{ review.helpful }})
                </button>
            </div>
        </div>
    </div>

    <!-- Write a Review Button -->
    <div class="write-review-wrapper">
        <button class="btn-write-review">
            <i class="fa-solid fa-pen-to-square"></i>
            Write a Review
        </button>
    </div>
</div>